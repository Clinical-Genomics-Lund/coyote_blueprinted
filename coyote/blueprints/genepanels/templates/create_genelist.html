{% extends "layout.html" %}
{% block title %}Create Gene Panel{% endblock %}
{% block style %}
  <link href="{{ url_for('genepanels_bp.static', filename='css/style.css') }}" rel="stylesheet">
{% endblock %}
{% block script %}
  <script>
    const validateNameUrl = '{{ url_for("genepanels_bp.validate_name") }}';
    const validateDisplayNameUrl = '{{ url_for("genepanels_bp.validate_displayname") }}';
  </script>
  <script src="{{ url_for('genepanels_bp.static', filename='js/create_genelist.js') }}"></script>
{% endblock %}

{% block body %}
  <div class="container mx-auto py-10">
    <!-- New Gene List Form -->
    <div class="bg-white shadow-lg rounded-xl p-8">
      <h2 class="text-2xl font-semibold mb-6">Create New Gene Panel</h2>
      <form id="genePanelForm" action="{{ url_for('genepanels_bp.create_genelist') }}" method="post" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="mb-4">
          {{ form.name.label(class="block text-gray-700 text-sm font-bold mb-2") }}
          {{ form.name(class="form-input bg-white border border-gray-300 rounded-lg py-2 px-4 w-full", placeholder="Enter name", id="nameField") }}
          <span id="nameError" class="text-red-500 text-sm"></span>
        </div>
        <div class="mb-4">
          {{ form.displayname.label(class="block text-gray-700 text-sm font-bold mb-2") }}
          {{ form.displayname(class="form-input bg-white border border-gray-300 rounded-lg py-2 px-4 w-full", placeholder="Enter display name", id="displaynameField") }}
          <span id="displaynameError" class="text-red-500 text-sm"></span>
        </div>
        <div class="mb-4">
          {{ form.type.label(class="block text-gray-700 text-sm font-bold mb-2") }}
          {{ form.type(class="form-select bg-white border border-gray-300 rounded-lg py-2 px-4 w-full") }}
        </div>
        <div class="mb-4">
          {{ form.genes_file.label(class="block text-gray-700 text-sm font-bold mb-2") }}
          {{ form.genes_file(class="form-input bg-white border border-gray-300 rounded-lg py-2 px-4 w-full") }}
          <span class="text-gray-500 text-sm">or</span>
          {{ form.genes_text(class="form-input bg-white border border-gray-300 rounded-lg py-2 px-4 w-full mt-2", rows="4", placeholder="Paste comma-separated or newline-separated gene list") }}
        </div>
        <div class="mb-4">
          {{ form.assays.label(class="block text-gray-700 text-sm font-bold mb-2") }}
          <input type="text" id="new_assay_input" placeholder="Add new assay or select from suggestions" class="form-input bg-white border border-gray-300 rounded-lg py-2 px-4 w-full mt-2">
          <div id="suggested-assays" class="flex flex-wrap gap-2 mt-4">
            <!-- Display existing assays with a + icon -->
            {% for assay in available_assays %}
            <div class="suggestion-item flex items-center space-x-2 bg-gray-200 rounded-lg px-3 py-2 cursor-pointer hover:bg-gray-300">
              <span>{{ assay }}</span>
              <button type="button" class="text-green-500 hover:text-green-700 add-assay">+</button>
            </div>
            {% endfor %}
          </div>
          <div id="assay-container" class="flex flex-wrap gap-2 mt-4">
            <!-- User-selected assays will appear here -->
          </div>
          <input type="hidden" name="assays" id="assays_field" value="">
        </div>
        <div class="flex justify-end">
          {{ form.submit(class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out") }}
        </div>
      </form>
    </div>
  </div>
{% endblock %}