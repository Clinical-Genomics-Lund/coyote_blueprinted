{% extends "layout.html" %}
{% block title %}Change Password{% endblock %}
{% block body %}
<div class="flex justify-center mt-10 min-h-full bg-gray-100">
  <div class="w-full max-w-md">
    <div class="bg-white shadow-lg rounded-lg px-8 py-10">
      <h1 class="text-3xl font-semibold text-center text-gray-700 mb-6">Change Password</h1>
      <form method="POST" name="form" class="space-y-6">
        {{ form.csrf_token }}
        <div class="mb-4">
          <label class="block text-gray-600 text-sm font-medium mb-2" for="old_password">
            {{ form.old_password.label }}
          </label>
          {{ form.old_password(class="shadow-sm appearance-none border border-gray-300 rounded-md w-full py-2 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
          {% for error in form.old_password.errors %}
              <div class="text-red-600 text-sm mt-1">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="mb-4">
          <label class="block text-gray-600 text-sm font-medium mb-2" for="new_password">
            {{ form.new_password.label }}
          </label>
          {{ form.new_password(id="new_password", class="shadow-sm appearance-none border border-gray-300 rounded-md w-full py-2 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
          <div id="passwordHelpBlock" class="text-gray-500 text-sm mt-1">
            Password must be at least 15 characters long, contain an uppercase letter, a number, and a special character.
          </div>
          <div id="passwordFeedback" class="text-sm mt-1"></div>
        </div>
        <div class="mb-4">
          <label class="block text-gray-600 text-sm font-medium mb-2" for="confirm_password">
            {{ form.confirm_password.label }}
          </label>
          {{ form.confirm_password(id="confirm_password", class="shadow-sm appearance-none border border-gray-300 rounded-md w-full py-2 px-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent") }}
          <div id="confirmPasswordFeedback" class="text-sm mt-1"></div>
        </div>
        <div class="flex items-center justify-between">
          <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">Change Password</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    const newPassword = document.querySelector('#new_password');
    const confirmPassword = document.querySelector('#confirm_password');
    const passwordFeedback = document.querySelector('#passwordFeedback');
    const confirmPasswordFeedback = document.querySelector('#confirmPasswordFeedback');

    const validatePassword = () => {
      const password = newPassword.value;
      const confirmPass = confirmPassword.value;
      const lengthValid = password.length >= 15;
      const uppercaseValid = /[A-Z]/.test(password);
      const numberValid = /\d/.test(password);
      const specialCharValid = /[\W_]/.test(password);

      let message = '';

      if (!lengthValid) {
          message += 'Password must be at least 15 characters long. ';
      }
      if (!uppercaseValid) {
          message += 'Password must contain at least one uppercase letter. ';
      }
      if (!numberValid) {
          message += 'Password must contain at least one digit. ';
      }
      if (!specialCharValid) {
          message += 'Password must contain at least one special character. ';
      }

      if (lengthValid && uppercaseValid && numberValid && specialCharValid) {
        passwordFeedback.textContent = 'Password is strong';
        passwordFeedback.classList.remove('text-red-600');
        passwordFeedback.classList.add('text-green-600');
      } else {
        passwordFeedback.textContent = message;
        passwordFeedback.classList.remove('text-green-600');
        passwordFeedback.classList.add('text-red-600');
      }

      if (confirmPass && password !== confirmPass) {
        confirmPasswordFeedback.textContent = 'Passwords do not match';
        confirmPasswordFeedback.classList.remove('text-green-600');
        confirmPasswordFeedback.classList.add('text-red-600');
      } else if (confirmPass) {
        confirmPasswordFeedback.textContent = 'Passwords match';
        confirmPasswordFeedback.classList.remove('text-red-600');
        confirmPasswordFeedback.classList.add('text-green-600');
      } else {
        confirmPasswordFeedback.textContent = '';
      }
    };

    newPassword.addEventListener('input', validatePassword);
    confirmPassword.addEventListener('input', validatePassword);
  });
</script>
{% endblock %}
